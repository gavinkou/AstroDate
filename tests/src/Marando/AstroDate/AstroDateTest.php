<?php

namespace Marando\AstroDate;

use \Marando\Units\Time;
use \Marando\Units\Angle;

/**
 * Generated by PHPUnit_SkeletonGenerator on 2015-10-21 at 03:18:18.
 */
class AstroDateTest extends \PHPUnit_Framework_TestCase {
  //----------------------------------------------------------------------------
  // Unit Tests
  //----------------------------------------------------------------------------

  /**
   * @covers Marando\AstroDate\AstroDate::jd
   */
  public function testJD() {
    $dates = [
        // Date, JD
        ['2000-Jan-01 00:00:00', 2451544.500000],
        ['2100-Oct-12 18:20:04', 2488354.263935],
        ['2089-Nov-08 21:14:18', 2484364.3849301],
    ];

    foreach ($dates as $d) {
      $fromJD  = AstroDate::jd($d[1]);
      $fromStr = AstroDate::parse($d[0]);

      $this->assertEquals($fromStr, $fromJD, "to JD $fromJD", 1e-1);
    }

    foreach ($dates as $d) {
      $date = AstroDate::parse($d[0]);
      $this->assertEquals($d[1], $date->jd, "from JD $fromJD", 1e-1);
    }
  }

  /**
   * @covers Marando\AstroDate\AstroDate::parse
   */
  public function testParse() {
    $dates = [
        ['2015-1-10 10:34:16', 2015, 1, 10, 10, 34, 16],
        ['2015-Feb-19 03:10', 2015, 2, 19, 3, 10, 0],
    ];

    foreach ($dates as $d) {
      $date = AstroDate::parse($d[0]);

      $this->assertEquals($d[1], $date->year, 'year');
      $this->assertEquals($d[2], $date->month, 'month');
      $this->assertEquals($d[3], $date->day, 'day');
      $this->assertEquals($d[4], $date->hour, 'hour');
      $this->assertEquals($d[5], $date->min, 'min');
      $this->assertEquals($d[6], $date->sec, 'sec');
    }
  }

  /**
   * Not sure how to test this really......
   * @covers Marando\AstroDate\AstroDate::now
   * @todo   Implement testNow().
   */
  public function testNow() {
    // Remove the following lines when you implement this test.
    $this->markTestIncomplete(
            'This test has not been implemented yet.'
    );
  }

  /**
   * @covers Marando\AstroDate\AstroDate::toUTC
   */
  public function testToUTC() {
    $d = AstroDate::jd(2456658.5004050927, TimeStandard::TAI());
    $this->assertEquals(2456658.5, $d->toUTC()->jd);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::toTAI
   */
  public function testToTAI() {
    $d = AstroDate::jd(2456658.5, TimeStandard::UTC());
    $this->assertEquals(2456658.5004050927, $d->toTAI()->jd);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::toTT
   */
  public function testToTT() {
    $d = AstroDate::jd(2456658.5, TimeStandard::UTC());
    $this->assertEquals(2456658.5007775929, $d->toTT()->jd, null, 1e-9);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::toTDB
   */
  public function testToTDB() {
    $d = AstroDate::jd(2456658.5, TimeStandard::UTC());
    $this->assertEquals(2456658.500777592, $d->toTT()->jd, null, 1e-9);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::toUT1
   * @todo   Implement testToUT1().
   */
  public function testToUT1() {
    // Remove the following lines when you implement this test.
    $this->markTestIncomplete(
            'This test has not been implemented yet.'
    );
  }

  /**
   * @covers Marando\AstroDate\AstroDate::diff
   */
  public function testDiff() {
    $a = AstroDate::parse('2015-Jan-01');
    $b = AstroDate::parse('2017-Feb-08');

    $this->assertEquals(-769, $a->diff($b)->days);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::add
   */
  public function testAdd() {
    $d = AstroDate::jd(2457792.500000)->add(Time::days(15));
    $this->assertEquals(23, $d->day);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::subtract
   */
  public function testSubtract() {
    $d = AstroDate::jd(2457792.500000)->subtract(Time::sec(83829));
    $this->assertEquals(51, round($d->sec, 0));
  }

  /**
   * @covers Marando\AstroDate\AstroDate::sinceMidnight

   */
  public function testSinceMidnight() {
    $dates = [
        [AstroDate::parse('2010-Jan-10 16:37:10'), Time::sec(59830)],
        [AstroDate::parse('2501-Nov-11 14:07:29'), Time::sec(50849)],
    ];

    foreach ($dates as $d) {
      $this->assertEquals($d[1], $d[0]->sinceMidnight(), $d[0]);
    }
  }

  /**
   * @covers Marando\AstroDate\AstroDate::untilMidnight
   */
  public function testUntilMidnight() {
    $dates = [
        [AstroDate::parse('2010-Jan-10 16:37:10'), Time::sec(86400 - 59830)],
        [AstroDate::parse('2501-Nov-11 14:07:29'), Time::sec(86400 - 50849)],
    ];

    foreach ($dates as $d) {
      $this->assertEquals($d[1], $d[0]->untilMidnight(), $d[0]);
    }
  }

  /**
   * @covers Marando\AstroDate\AstroDate::gast
   */
  public function testGAST() {
    $dates = [
        //[AstroDate::parse('1987-Apr-10'), 47446.3668],
        //[AstroDate::parse('1987-Apr-10 19:21:00'), 30897.0896],
        [AstroDate::jd(2453736.5, TimeStandard::TT()), 24121.515905]
    ];

    foreach ($dates as $d)
      $this->assertEquals($d[1], $d[0]->gast()->sec, $d[0], 1e-4);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::gmst
   */
  public function testGMST() {
    $dates = [
        //[AstroDate::parse('1987-Apr-10'), 47446.1351],
        [AstroDate::jd(2453736.5, TimeStandard::TT()), 24121.637385]
    ];

    foreach ($dates as $d)
      $this->assertEquals($d[1], $d[0]->gmst()->sec, $d[0], 1e-4);
  }

  /**
   * @covers Marando\AstroDate\AstroDate::monthName
   */
  public function testMonthName() {
    $d = AstroDate::parse('2015-09-17');

    $this->assertEquals('September', $d->monthName(), 'full');
    $this->assertEquals('Sep', $d->monthName(false), 'short');
  }

  /**
   * @covers Marando\AstroDate\AstroDate::toEpoch
   */
  public function testToEpoch() {
    $dt = AstroDate::jd(2451545.0, TimeStandard::TT());
    $this->AssertEquals(Epoch::J2000(), $dt->toEpoch());
  }

  //----------------------------------------------------------------------------
  // Bugs
  //----------------------------------------------------------------------------

  public function testBug() {
    return;
    // this returns feb-8
    $b = AstroDate::parse('2017-Feb-08');

    // no leading 0 causes wrong parse
    // this returns feb-1
    $b = AstroDate::parse('2017-Feb-8');

    // correct JD from USNO
    $this->assertEquals(2457792.5, $b->jd);
  }

}
